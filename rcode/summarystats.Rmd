---
title: "summary stats"
author: "Claire Jellison"
date: "12/27/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(tidyverse)
library(lubridate)
library(quantmod)
library(ggpointdensity)
library(stringr)
```


```{r}
df <- read.csv("dhist1to4.csv")
dhist <- tbl_df(df)

df2 <- read.csv("dhist5to8.csv")
dhisttest <- tbl_df(df2)
dhisttest <- sumstats(dhisttest)

dhistall <- read.csv("dfc.csv")
dfc <- read.csv("dfc.csv")
```


```{r}
#corresponds to table 2.1
nrow(dhistall)
mean(dhistall$amount)
sum(dhistall$amount)
median(dhistall$amount)


anonhist <- dhistall %>% dplyr::filter(gender == "anonymous")
nrow(anonhist)
mean(anonhist$amount)

malehist <- dhistall %>% dplyr::filter(gender == "male")
nrow(malehist)
mean(malehist$amount)

femalehist <- dhistall %>% dplyr::filter(gender == "female")
nrow(femalehist)
mean(femalehist$amount)

unknownhist <- dhistall %>% dplyr::filter(is.na(gender))
nrow(unknownhist)
mean(unknownhist$amount)

dhistsum <- dhistall %>% group_by(category) %>% group_by(gender, add = TRUE) %>% summarize(total = n(), meand = mean(amount)) %>% arrange(desc(total), .by_group = TRUE)

```



```{r}
#this is figure 2.4 
dfc %>% dplyr::filter(terminated != TRUE) %>% distinct(urlsolid, .keep_all = TRUE) %>% mutate(progress = progress *100) %>%
ggplot( aes(x = progress)) + geom_histogram(aes(y=..density..), colour="black", fill="white") +
 geom_density(alpha=.2, fill="#FF6666") + xlim(0,150) 
ggsave("pdffund.png", width = 7, height = 4, units = "in")
```



```{r}
#this is figure 2.3
dhistall %>% 
  ggplot(aes(x = amount)) + 
  geom_histogram(binwidth = 5, fill = "white", color="steelblue", position = "identity") +
  xlim(0,120)
ggsave("amtdist.png", width = 7, height = 4, units = "in")
```


```{r}
#this is figure 2.5
dhistall$month <- fct_relevel(dhistall$month, levels = c("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"))
                           
ggplot(dhistall, aes(x = month, y = amount))  +
  geom_boxplot() + ylim(0,150)


ggsave("monthdonations.png", width = 7, height = 4, units = "in")
```


```{r}
dhistall %>% 
  group_by(dow) %>% 
  summarise(meand = mean(amount)) %>% 
  ggplot(aes(x = dow, y = meand))  +
  geom_point() + ylim(0,150)
```


```{r}
#this is figure 2.6
ggplot(dhistall, aes(x = hourofday, y = amount)) +
  geom_pointdensity() +
  scale_color_viridis_c() + 
  ylim(0,250)
ggsave("timeofdaydonations.png", width = 7, height = 4, units = "in")
```


```{r}
dhistall$category<- gsub("[^A-Za-z0-9 ]","",dhistall$category)
dhistall$category<- str_replace(dhistall$category,"fundraiser","")
dhistall$gender <- as.character(dhistall$gender)
dhistall$nbrSims[is.na(dhistall$gender)] <- "unknown"

dhistall %>%   
  group_by(category) %>% 
  summarize(meanamount = mean(amount)) %>% 
  arrange(meanamount) %>% 
  dplyr::filter(category != "NA") %>% 
  ggplot(aes(x = reorder(category, -meanamount), y = meanamount)) + 
  geom_bar(stat = "identity", color="steelblue", fill="white") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  ylab("mean donation") +
  xlab("category")

ggsave("mmeanbycate.png", width = 7, height = 4, units = "in")

dhistall %>%   
  mutate(gender = replace_na(gender, "unknown")) %>%
  group_by(category, gender) %>% 
  summarize(countamount = n()) %>% 
  dplyr::filter(category != "NA") %>% 
  ggplot(aes(fill = gender, x = reorder(category, -countamount), y = countamount)) + 
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  scale_fill_brewer(palette="Dark2") + 
  ylab("total donations") +
  xlab("category")

ggsave("totbycate.png", width = 7, height = 4, units = "in")

```


```{r}
lambda <- nrow(dhistall$timeafter)/sum(dhistall$timeafter)
eq = function(x){lambda * exp(-lambda*x)}

ggplot(dhistall, aes(x = timeafter))  +
  geom_histogram(bins = 30) + xlim(0, 50000) + 
  stat_function(fun=eq)

x <- seq(0, 1000, length.out=1000)
dat <- data.frame(x=x, px=dexp(x, rate=lambda))
ggplot(dat, aes(x=x, y=px)) + geom_line()

ggplot(data.frame(x=c(1, 50000)), aes(x=x)) + 
  stat_function(fun=eq)

```


