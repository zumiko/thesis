---
title: "trees"
author: "Claire Jellison"
date: "2/8/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(fBasics)
```


```{r}
lagsort<- function(lagrow){
  a <- lagrow[1]
  b <- lagrow[2] 
  c <- lagrow[3] 
  d <- lagrow[4] 
  e <- lagrow[5]
  vec <- c(a,b,c,d,e)
  vec <- sort(vec, decreasing = FALSE) # so the are in increasing order 
  vec
}
```



```{r}
dhistsize <- na.omit(dhist) %>%
  ungroup(as.factor(urlsolid)) %>% 
  filter(lagtype == "five") %>% 
  select(lag1,lag2,lag3,lag4,lag5) 


variance <- apply(dhistsize, 1, var)
skew <- apply(dhistsize, 1, skewness)
dhistsize$variance <- variance
dhistsize$skewness <- skew

lagsrt <- apply(dhistsize,1, lagsort) 
tlagsrt <- t(lagsrt)
tlagsrt <- as.data.frame(tlagsrt)
dhistsize$d1 <- tlagsrt[,1]
dhistsize$d2 <- tlagsrt[,2]
dhistsize$d3 <- tlagsrt[,3]
dhistsize$d4 <- tlagsrt[,4]
dhistsize$d5 <- tlagsrt[,5]
head(dhistsize)

#put them in order of smallest to greatest 
#d_1, d_2, d_3, d_4, d_5 

dhistomit <- na.omit(dhist) %>%
  ungroup(as.factor(urlsolid)) %>%
  filter(lagtype == "five") %>% select(-lag1, -lag2, -lag3, -lag4, -lag5)
dhistsize <- cbind(dhistomit,dhistsize)


```

now time for the basic tree model

```{r}
library(tree)
library(gbm)
library(randomForest)
```


```{r}
dhistree <- dhistsize %>% mutate(amount = unlist(amount))
dhistree <- dhistree %>% select(amount, d1, d2, d3, d4, d5)
treebasic <-  tree(formula = amount ~. , data = dhistree)
summary(treebasic)
plot(treebasic)
text(treebasic ,pretty=0)
```

```{r}
treeboost = gbm(formula = amount ~. , data = dhistree,distribution=
"gaussian",n.trees=5000, interaction.depth = 4)
summary(treeboost)
par(mfrow=c(1,2))
plot(treeboost ,i="d2") 
plot(treeboost,i="d1")
```


```{r}
bagtree =randomForest(amount ~. ,data = dhist2tree,
mtry=5,importance =TRUE)
```

#Now let's see how they compare and preform on a test data set 




